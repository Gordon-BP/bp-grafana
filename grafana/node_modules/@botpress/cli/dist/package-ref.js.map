{
  "version": 3,
  "sources": ["../src/package-ref.ts"],
  "sourcesContent": ["import * as sdk from '@botpress/sdk'\nimport semver from 'semver'\nimport * as utils from './utils'\n\ntype PackageType = sdk.Package['type']\nconst packageTypes: Record<PackageType, null> = {\n  integration: null,\n  interface: null,\n  plugin: null,\n}\nconst isPackageType = (type: string): type is PackageType => type in packageTypes\n\nexport type UUIDPackageRef = {\n  type: 'id'\n  id: string\n}\n\nexport type NamePackageRef = {\n  type: 'name'\n  pkg?: PackageType\n  name: string\n  version: string\n}\n\nexport type LocalPackageRef = {\n  type: 'path'\n  path: string\n}\n\nexport type ApiPackageRef = UUIDPackageRef | NamePackageRef\nexport type PackageRef = ApiPackageRef | LocalPackageRef\n\nconst LATEST_TAG = 'latest'\n\nexport const isLatest = (ref: NamePackageRef): boolean => ref.version === LATEST_TAG\n\nexport const formatPackageRef = (ref: PackageRef): string => {\n  if (ref.type === 'path') {\n    return ref.path\n  }\n  if (ref.type === 'id') {\n    return ref.id\n  }\n  if (ref.pkg) {\n    return `${ref.pkg}:${ref.name}@${ref.version}`\n  }\n  return `${ref.name}@${ref.version}`\n}\n\nexport const parsePackageRef = (ref: string): PackageRef | undefined => {\n  if (!ref) {\n    return\n  }\n\n  if (utils.id.isValidID(ref)) {\n    return { type: 'id', id: ref }\n  }\n\n  if (utils.path.isPath(ref)) {\n    return { type: 'path', path: ref }\n  }\n\n  return parseNamePackageRef(ref)\n}\n\nconst parseNamePackageRef = (ref: string): NamePackageRef | undefined => {\n  if (!ref) {\n    return\n  }\n\n  if (ref.includes(':')) {\n    const [pkg, nameVersion] = ref.split(':')\n    if (!pkg || !nameVersion) {\n      return\n    }\n    if (!isPackageType(pkg)) {\n      return\n    }\n    const parsed = parseNamePackageRef(nameVersion)\n    if (!parsed) {\n      return\n    }\n    return { ...parsed, pkg }\n  }\n\n  if (!ref.includes('@')) {\n    return { type: 'name', name: ref, version: LATEST_TAG }\n  }\n\n  const [name, version] = ref.split('@')\n  if (!name || !version) {\n    return\n  }\n\n  const cleanedVersion = version === LATEST_TAG ? version : semver.clean(version)\n  if (!cleanedVersion) {\n    return\n  }\n\n  return { type: 'name', name, version: cleanedVersion }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,oBAAmB;AACnB,YAAuB;AAGvB,MAAM,eAA0C;AAAA,EAC9C,aAAa;AAAA,EACb,WAAW;AAAA,EACX,QAAQ;AACV;AACA,MAAM,gBAAgB,CAAC,SAAsC,QAAQ;AAsBrE,MAAM,aAAa;AAEZ,MAAM,WAAW,CAAC,QAAiC,IAAI,YAAY;AAEnE,MAAM,mBAAmB,CAAC,QAA4B;AAC3D,MAAI,IAAI,SAAS,QAAQ;AACvB,WAAO,IAAI;AAAA,EACb;AACA,MAAI,IAAI,SAAS,MAAM;AACrB,WAAO,IAAI;AAAA,EACb;AACA,MAAI,IAAI,KAAK;AACX,WAAO,GAAG,IAAI,OAAO,IAAI,QAAQ,IAAI;AAAA,EACvC;AACA,SAAO,GAAG,IAAI,QAAQ,IAAI;AAC5B;AAEO,MAAM,kBAAkB,CAAC,QAAwC;AACtE,MAAI,CAAC,KAAK;AACR;AAAA,EACF;AAEA,MAAI,MAAM,GAAG,UAAU,GAAG,GAAG;AAC3B,WAAO,EAAE,MAAM,MAAM,IAAI,IAAI;AAAA,EAC/B;AAEA,MAAI,MAAM,KAAK,OAAO,GAAG,GAAG;AAC1B,WAAO,EAAE,MAAM,QAAQ,MAAM,IAAI;AAAA,EACnC;AAEA,SAAO,oBAAoB,GAAG;AAChC;AAEA,MAAM,sBAAsB,CAAC,QAA4C;AACvE,MAAI,CAAC,KAAK;AACR;AAAA,EACF;AAEA,MAAI,IAAI,SAAS,GAAG,GAAG;AACrB,UAAM,CAAC,KAAK,WAAW,IAAI,IAAI,MAAM,GAAG;AACxC,QAAI,CAAC,OAAO,CAAC,aAAa;AACxB;AAAA,IACF;AACA,QAAI,CAAC,cAAc,GAAG,GAAG;AACvB;AAAA,IACF;AACA,UAAM,SAAS,oBAAoB,WAAW;AAC9C,QAAI,CAAC,QAAQ;AACX;AAAA,IACF;AACA,WAAO,EAAE,GAAG,QAAQ,IAAI;AAAA,EAC1B;AAEA,MAAI,CAAC,IAAI,SAAS,GAAG,GAAG;AACtB,WAAO,EAAE,MAAM,QAAQ,MAAM,KAAK,SAAS,WAAW;AAAA,EACxD;AAEA,QAAM,CAAC,MAAM,OAAO,IAAI,IAAI,MAAM,GAAG;AACrC,MAAI,CAAC,QAAQ,CAAC,SAAS;AACrB;AAAA,EACF;AAEA,QAAM,iBAAiB,YAAY,aAAa,UAAU,cAAAA,QAAO,MAAM,OAAO;AAC9E,MAAI,CAAC,gBAAgB;AACnB;AAAA,EACF;AAEA,SAAO,EAAE,MAAM,QAAQ,MAAM,SAAS,eAAe;AACvD;",
  "names": ["semver"]
}
