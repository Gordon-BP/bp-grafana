{
  "version": 3,
  "sources": ["../../src/api/find-previous-version.ts"],
  "sourcesContent": ["import * as client from '@botpress/client'\nimport semver from 'semver'\nimport { NamePackageRef } from '../package-ref'\nimport * as paging from './paging'\nimport { IntegrationSummary } from './types'\n\nexport const findPreviousIntegrationVersion = async (\n  client: client.Client,\n  ref: NamePackageRef\n): Promise<IntegrationSummary | undefined> => {\n  const { name, version: targetVersion } = ref\n  const allVersions = await paging.listAllPages(\n    async ({ nextToken }) => client.listIntegrations({ name, nextToken }),\n    (r) => r.integrations\n  )\n\n  const orderedVersions = allVersions.sort((a, b) => semver.compare(b.version, a.version))\n  const latestVersion = orderedVersions[0]\n  if (!latestVersion) {\n    return\n  }\n\n  type VersionIdx = [number, IntegrationSummary]\n\n  let current: VersionIdx = [0, latestVersion]\n  while (semver.gte(current[1].version, targetVersion)) {\n    const nextIdx = current[0] + 1\n    const nextIntegration = orderedVersions[nextIdx]\n    if (!nextIntegration) {\n      break\n    }\n    current = [nextIdx, nextIntegration]\n  }\n\n  const previous = current[1]\n  if (semver.gte(previous.version, targetVersion)) {\n    return\n  }\n\n  return previous\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,oBAAmB;AAEnB,aAAwB;AAGjB,MAAM,iCAAiC,OAC5CA,SACA,QAC4C;AAC5C,QAAM,EAAE,MAAM,SAAS,cAAc,IAAI;AACzC,QAAM,cAAc,MAAM,OAAO;AAAA,IAC/B,OAAO,EAAE,UAAU,MAAMA,QAAO,iBAAiB,EAAE,MAAM,UAAU,CAAC;AAAA,IACpE,CAAC,MAAM,EAAE;AAAA,EACX;AAEA,QAAM,kBAAkB,YAAY,KAAK,CAAC,GAAG,MAAM,cAAAC,QAAO,QAAQ,EAAE,SAAS,EAAE,OAAO,CAAC;AACvF,QAAM,gBAAgB,gBAAgB;AACtC,MAAI,CAAC,eAAe;AAClB;AAAA,EACF;AAIA,MAAI,UAAsB,CAAC,GAAG,aAAa;AAC3C,SAAO,cAAAA,QAAO,IAAI,QAAQ,GAAG,SAAS,aAAa,GAAG;AACpD,UAAM,UAAU,QAAQ,KAAK;AAC7B,UAAM,kBAAkB,gBAAgB;AACxC,QAAI,CAAC,iBAAiB;AACpB;AAAA,IACF;AACA,cAAU,CAAC,SAAS,eAAe;AAAA,EACrC;AAEA,QAAM,WAAW,QAAQ;AACzB,MAAI,cAAAA,QAAO,IAAI,SAAS,SAAS,aAAa,GAAG;AAC/C;AAAA,EACF;AAEA,SAAO;AACT;",
  "names": ["client", "semver"]
}
